{
  "version": 3,
  "file": "jsenv_cancellation.cjs",
  "sources": [
    "../../src/createCancellationToken.js",
    "../../src/internal/memoizeOnce.js",
    "../../src/operation/createAbortableOperation.js",
    "../../src/operation/createOperation.js",
    "../../src/operation/createConcurrentOperations.js",
    "../../src/operation/createOperationSequence.js",
    "../../src/operation/createStoppableOperation.js",
    "../../src/operation/firstOperationMatching.js",
    "../../src/cancelError.js",
    "../../src/composeCancellationToken.js",
    "../../src/internal/arrayHelper.js",
    "../../src/createCancellationSource.js",
    "../../src/createCancellationTokenForProcess.js",
    "../../src/internal/wrapFunctionToCatchCancellation.js",
    "../../src/internal/wrapFunctionToConsiderUnhandledRejectionsAsExceptions.js",
    "../../src/executeAsyncFunction.js"
  ],
  "sourcesContent": [
    "export const createCancellationToken = () => {\n  const register = (callback) => {\n    if (typeof callback !== \"function\") {\n      throw new Error(`callback must be a function, got ${callback}`)\n    }\n\n    return {\n      callback,\n      unregister: () => {},\n    }\n  }\n\n  const throwIfRequested = () => undefined\n\n  return {\n    register,\n    cancellationRequested: false,\n    throwIfRequested,\n  }\n}\n",
    "export const memoizeOnce = (compute) => {\n  let locked = false\n  let lockValue\n\n  const memoized = (...args) => {\n    if (locked) return lockValue\n    // if compute is recursive wait for it to be fully done before storing the lockValue\n    // so set locked later\n    lockValue = compute(...args)\n    locked = true\n    return lockValue\n  }\n\n  memoized.deleteCache = () => {\n    const value = lockValue\n    locked = false\n    lockValue = undefined\n    return value\n  }\n\n  return memoized\n}\n",
    "import { createCancellationToken } from \"../createCancellationToken.js\"\nimport { memoizeOnce } from \"../internal/memoizeOnce.js\"\n\nexport const createAbortableOperation = ({\n  cancellationToken = createCancellationToken(),\n  start,\n  abort,\n  ...rest\n}) => {\n  if (typeof abort !== \"function\") {\n    throw new TypeError(`abort must be a function, got ${abort}`)\n  }\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createAbortableOperation called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nstart\nabort`)\n  }\n\n  cancellationToken.throwIfRequested()\n\n  const promise = new Promise((resolve) => {\n    resolve(start())\n  })\n  const cancelPromise = new Promise((resolve, reject) => {\n    const cancelRegistration = cancellationToken.register((cancelError) => {\n      cancelRegistration.unregister()\n      reject(cancelError)\n    })\n    promise.then(cancelRegistration.unregister, () => {})\n  })\n  const operationPromise = Promise.race([promise, cancelPromise])\n\n  const abortInternal = memoizeOnce(abort)\n  const abortRegistration = cancellationToken.register(abortInternal)\n  promise.then(abortRegistration.unregister, () => {})\n  operationPromise.abort = abortInternal\n\n  return operationPromise\n}\n",
    "import { createCancellationToken } from \"../createCancellationToken.js\"\n\nexport const createOperation = ({\n  cancellationToken = createCancellationToken(),\n  start,\n  ...rest\n}) => {\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createOperation called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nstart`)\n  }\n\n  cancellationToken.throwIfRequested()\n  const promise = new Promise((resolve) => {\n    resolve(start())\n  })\n  const cancelPromise = new Promise((resolve, reject) => {\n    const cancelRegistration = cancellationToken.register((cancelError) => {\n      cancelRegistration.unregister()\n      reject(cancelError)\n    })\n    promise.then(cancelRegistration.unregister, () => {})\n  })\n  const operationPromise = Promise.race([promise, cancelPromise])\n\n  return operationPromise\n}\n",
    "/*\nWe could pick from array like this\n\nmaxParallelExecution: 2\narray: [a, b, c, d]\n\nWe could start [a,b]\nAnd immediatly after a or b finish, start c\nAnd immediatly after any finishes, start d\n\nThis approach try to maximize maxParallelExecution.\nBut it has one hidden disadvantage.\n\nIf the tasks can queue each other there is a chance that\na task gets constantly delayed by other started task\ngiving the false feeling that the task takes a long time\nto be done.\n\nTo avoid this I prefer to start them chunk by chunk\nso it means [a,b] and then [c,d] that will wait for a and b to complete\n\n*/\n\nimport { createCancellationToken } from \"../createCancellationToken.js\"\nimport { createOperation } from \"./createOperation.js\"\n\nexport const createConcurrentOperations = async ({\n  cancellationToken = createCancellationToken(),\n  concurrencyLimit = 5,\n  array,\n  start,\n  ...rest\n}) => {\n  if (typeof concurrencyLimit !== \"number\") {\n    throw new TypeError(`concurrencyLimit must be a number, got ${concurrencyLimit}`)\n  }\n  if (concurrencyLimit < 1) {\n    throw new Error(`concurrencyLimit must be 1 or more, got ${concurrencyLimit}`)\n  }\n  if (typeof array !== \"object\") {\n    throw new TypeError(`array must be an array, got ${array}`)\n  }\n  if (typeof start !== \"function\") {\n    throw new TypeError(`start must be a function, got ${start}`)\n  }\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createConcurrentOperations called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nconcurrencyLimit\narray\nstart`)\n  }\n\n  const outputArray = []\n  let progressionIndex = 0\n  let remainingExecutionCount = array.length\n\n  const nextChunk = async () => {\n    await createOperation({\n      cancellationToken,\n      start: async () => {\n        const outputPromiseArray = []\n        while (remainingExecutionCount > 0 && outputPromiseArray.length < concurrencyLimit) {\n          remainingExecutionCount--\n          const outputPromise = executeOne(progressionIndex)\n          progressionIndex++\n          outputPromiseArray.push(outputPromise)\n        }\n\n        if (outputPromiseArray.length) {\n          await Promise.all(outputPromiseArray)\n          if (remainingExecutionCount > 0) {\n            await nextChunk()\n          }\n        }\n      },\n    })\n  }\n\n  const executeOne = async (index) => {\n    return createOperation({\n      cancellationToken,\n      start: async () => {\n        const input = array[index]\n        const output = await start(input)\n        outputArray[index] = output\n      },\n    })\n  }\n\n  await nextChunk()\n\n  return outputArray\n}\n",
    "import { createCancellationToken } from \"../createCancellationToken.js\"\nimport { createOperation } from \"./createOperation.js\"\n\nexport const createOperationSequence = async ({\n  cancellationToken = createCancellationToken(),\n  array,\n  start,\n}) => {\n  const results = []\n  await array.reduce((previous, value) => {\n    return createOperation({\n      cancellationToken,\n      start: async () => {\n        await previous\n        const result = await start(value)\n        results.push(result)\n      },\n    })\n  }, Promise.resolve())\n  return results\n}\n",
    "import { createCancellationToken } from \"../createCancellationToken.js\"\nimport { memoizeOnce } from \"../internal/memoizeOnce.js\"\n\nexport const createStoppableOperation = ({\n  cancellationToken = createCancellationToken(),\n  start,\n  stop,\n  ...rest\n}) => {\n  if (typeof stop !== \"function\") {\n    throw new TypeError(`stop must be a function. got ${stop}`)\n  }\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createStoppableOperation called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nstart\nstop`)\n  }\n  cancellationToken.throwIfRequested()\n\n  const promise = new Promise((resolve) => {\n    resolve(start())\n  })\n  const cancelPromise = new Promise((resolve, reject) => {\n    const cancelRegistration = cancellationToken.register((cancelError) => {\n      cancelRegistration.unregister()\n      reject(cancelError)\n    })\n    promise.then(cancelRegistration.unregister, () => {})\n  })\n  const operationPromise = Promise.race([promise, cancelPromise])\n\n  const stopInternal = memoizeOnce(async (reason) => {\n    const value = await promise\n    return stop(value, reason)\n  })\n  cancellationToken.register(stopInternal)\n  operationPromise.stop = stopInternal\n\n  return operationPromise\n}\n",
    "export const firstOperationMatching = ({ array, start, predicate }) => {\n  if (typeof array !== \"object\") {\n    throw new TypeError(`array must be an object, got ${array}`)\n  }\n  if (typeof start !== \"function\") {\n    throw new TypeError(`start must be a function, got ${start}`)\n  }\n  if (typeof predicate !== \"function\") {\n    throw new TypeError(`predicate must be a function, got ${predicate}`)\n  }\n\n  const visit = async (index) => {\n    if (index >= array.length) {\n      return undefined\n    }\n    const input = array[index]\n    const output = await start(input)\n    if (predicate(output)) {\n      return output\n    }\n    return visit(index + 1)\n  }\n\n  return visit(0)\n}\n",
    "export const createCancelError = (reason) => {\n  const cancelError = new Error(`canceled because ${reason}`)\n  cancelError.name = \"CANCEL_ERROR\"\n  cancelError.reason = reason\n  return cancelError\n}\n\nexport const isCancelError = (value) => {\n  return value && typeof value === \"object\" && value.name === \"CANCEL_ERROR\"\n}\n\nexport const errorToCancelReason = (error) => {\n  if (!isCancelError(error)) return \"\"\n  return error.reason\n}\n",
    "export const composeCancellationToken = (...tokens) => {\n  const register = (callback) => {\n    if (typeof callback !== \"function\") {\n      throw new Error(`callback must be a function, got ${callback}`)\n    }\n\n    const registrationArray = []\n\n    const visit = (i) => {\n      const token = tokens[i]\n      const registration = token.register(callback)\n      registrationArray.push(registration)\n    }\n    let i = 0\n    while (i < tokens.length) {\n      visit(i++)\n    }\n\n    const compositeRegistration = {\n      callback,\n      unregister: () => {\n        registrationArray.forEach((registration) => registration.unregister())\n        registrationArray.length = 0\n      },\n    }\n\n    return compositeRegistration\n  }\n\n  let requested = false\n  let cancelError\n  const internalRegistration = register((parentCancelError) => {\n    requested = true\n    cancelError = parentCancelError\n    internalRegistration.unregister()\n  })\n\n  const throwIfRequested = () => {\n    if (requested) {\n      throw cancelError\n    }\n  }\n\n  return {\n    register,\n    get cancellationRequested() {\n      return requested\n    },\n    throwIfRequested,\n  }\n}\n",
    "export const arrayWithout = (array, item) => {\n  const arrayWithoutItem = []\n  let i = 0\n  while (i < array.length) {\n    const value = array[i]\n    i++\n    if (value === item) {\n      continue\n    }\n    arrayWithoutItem.push(value)\n  }\n  return arrayWithoutItem\n}\n",
    "// https://github.com/tc39/proposal-cancellation/tree/master/stage0\nimport { arrayWithout } from \"./internal/arrayHelper.js\"\nimport { createCancelError } from \"./cancelError.js\"\n\nexport const createCancellationSource = () => {\n  let requested = false\n  let cancelError\n  let registrationArray = []\n  const cancel = (reason) => {\n    if (requested) return\n    requested = true\n    cancelError = createCancelError(reason)\n\n    const registrationArrayCopy = registrationArray.slice()\n    registrationArray.length = 0\n    registrationArrayCopy.forEach((registration) => {\n      registration.callback(cancelError)\n      // const removedDuringCall = registrationArray.indexOf(registration) === -1\n    })\n  }\n\n  const register = (callback) => {\n    if (typeof callback !== \"function\") {\n      throw new Error(`callback must be a function, got ${callback}`)\n    }\n\n    const existingRegistration = registrationArray.find((registration) => {\n      return registration.callback === callback\n    })\n    // don't register twice\n    if (existingRegistration) {\n      return existingRegistration\n    }\n\n    const registration = {\n      callback,\n      unregister: () => {\n        registrationArray = arrayWithout(registrationArray, registration)\n      },\n    }\n    registrationArray = [registration, ...registrationArray]\n\n    return registration\n  }\n\n  const throwIfRequested = () => {\n    if (requested) {\n      throw cancelError\n    }\n  }\n\n  return {\n    token: {\n      register,\n      get cancellationRequested() {\n        return requested\n      },\n      throwIfRequested,\n    },\n    cancel,\n  }\n}\n",
    "import { teardownSignal } from \"@jsenv/node-signals\"\nimport { createCancellationSource } from \"./createCancellationSource.js\"\n\nexport const createCancellationTokenForProcess = () => {\n  const teardownCancelSource = createCancellationSource()\n  teardownSignal.addCallback((reason) => teardownCancelSource.cancel(`process ${reason}`))\n  return teardownCancelSource.token\n}\n",
    "import { isCancelError } from \"../cancelError.js\"\n\nexport const wrapFunctionToCatchCancellation = (asyncFunction) => async (...args) => {\n  try {\n    const value = await asyncFunction(...args)\n    return value\n  } catch (error) {\n    if (isCancelError(error)) {\n      // it means consume of the function will resolve with a cancelError\n      // but when you cancel it means you're not interested in the result anymore\n      // thanks to this it avoid unhandledRejection\n      return error\n    }\n    throw error\n  }\n}\n",
    "export const wrapFunctionToConsiderUnhandledRejectionsAsExceptions = (fn) => async (...args) => {\n  const uninstall = installUnhandledRejectionMode()\n  try {\n    const value = await fn(...args)\n    return value\n  } finally {\n    // don't remove it immediatly to let nodejs emit the unhandled rejection\n    setTimeout(() => {\n      uninstall()\n    })\n  }\n}\n\nconst installUnhandledRejectionMode = () => {\n  const unhandledRejectionArg = getCommandArgument(process.execArgv, \"--unhandled-rejections\")\n  if (unhandledRejectionArg === \"strict\") {\n    return () => {}\n  }\n  if (unhandledRejectionArg === \"throw\") {\n    return () => {}\n  }\n\n  const onUnhandledRejection = (reason) => {\n    throw reason\n  }\n  process.once(\"unhandledRejection\", onUnhandledRejection)\n  return () => {\n    process.removeListener(\"unhandledRejection\", onUnhandledRejection)\n  }\n}\n\nconst getCommandArgument = (argv, name) => {\n  let i = 0\n\n  while (i < argv.length) {\n    const arg = argv[i]\n\n    if (arg === name) {\n      return {\n        name,\n        index: i,\n        value: \"\",\n      }\n    }\n\n    if (arg.startsWith(`${name}=`)) {\n      return {\n        name,\n        index: i,\n        value: arg.slice(`${name}=`.length),\n      }\n    }\n\n    i++\n  }\n\n  return null\n}\n",
    "import { wrapFunctionToCatchCancellation } from \"./internal/wrapFunctionToCatchCancellation.js\"\nimport { wrapFunctionToConsiderUnhandledRejectionsAsExceptions } from \"./internal/wrapFunctionToConsiderUnhandledRejectionsAsExceptions.js\"\n\nexport const executeAsyncFunction = (\n  fn,\n  { catchCancellation = false, considerUnhandledRejectionsAsExceptions = false } = {},\n) => {\n  if (catchCancellation) {\n    fn = wrapFunctionToCatchCancellation(fn)\n  }\n\n  if (considerUnhandledRejectionsAsExceptions) {\n    fn = wrapFunctionToConsiderUnhandledRejectionsAsExceptions(fn)\n  }\n\n  return fn()\n}\n"
  ],
  "names": [
    "createCancellationToken",
    "register",
    "callback",
    "Error",
    "unregister",
    "throwIfRequested",
    "undefined",
    "cancellationRequested",
    "memoizeOnce",
    "compute",
    "locked",
    "lockValue",
    "memoized",
    "args",
    "deleteCache",
    "value",
    "createAbortableOperation",
    "cancellationToken",
    "start",
    "abort",
    "rest",
    "TypeError",
    "unknownArgumentNames",
    "Object",
    "keys",
    "length",
    "promise",
    "Promise",
    "resolve",
    "cancelPromise",
    "reject",
    "cancelRegistration",
    "cancelError",
    "then",
    "operationPromise",
    "race",
    "abortInternal",
    "abortRegistration",
    "createOperation",
    "createConcurrentOperations",
    "concurrencyLimit",
    "array",
    "outputArray",
    "progressionIndex",
    "remainingExecutionCount",
    "nextChunk",
    "outputPromiseArray",
    "outputPromise",
    "executeOne",
    "push",
    "all",
    "index",
    "input",
    "output",
    "createOperationSequence",
    "results",
    "reduce",
    "previous",
    "result",
    "createStoppableOperation",
    "stop",
    "stopInternal",
    "reason",
    "firstOperationMatching",
    "predicate",
    "visit",
    "createCancelError",
    "name",
    "isCancelError",
    "errorToCancelReason",
    "error",
    "composeCancellationToken",
    "tokens",
    "registrationArray",
    "i",
    "token",
    "registration",
    "compositeRegistration",
    "forEach",
    "requested",
    "internalRegistration",
    "parentCancelError",
    "arrayWithout",
    "item",
    "arrayWithoutItem",
    "createCancellationSource",
    "cancel",
    "registrationArrayCopy",
    "slice",
    "existingRegistration",
    "find",
    "createCancellationTokenForProcess",
    "teardownCancelSource",
    "teardownSignal",
    "addCallback",
    "wrapFunctionToCatchCancellation",
    "asyncFunction",
    "wrapFunctionToConsiderUnhandledRejectionsAsExceptions",
    "fn",
    "uninstall",
    "installUnhandledRejectionMode",
    "setTimeout",
    "unhandledRejectionArg",
    "getCommandArgument",
    "process",
    "execArgv",
    "onUnhandledRejection",
    "once",
    "removeListener",
    "argv",
    "arg",
    "startsWith",
    "executeAsyncFunction",
    "catchCancellation",
    "considerUnhandledRejectionsAsExceptions"
  ],
  "mappings": "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"
}